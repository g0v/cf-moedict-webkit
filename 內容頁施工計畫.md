# 內容頁施工計畫(先完成基本華語) TODO List

## 概述

本計畫將實現與原專案 `moedict-webkit` 完全相同的字典內容頁面功能，包括字詞顯示、注音拼音、朗讀功能、部首筆畫、筆順動畫等。

## ✅ 已完成項目

- [x] **基本字典頁面結構** - 實現基本的 Preact 組件和 HTML 結構
- [x] **字典內容顯示** - 基本顯示字典條目、定義、例句
- [x] **跨語言對照** - 顯示不同語言版本的對照
- [x] **翻譯功能** - 顯示英文、德文、法文翻譯
- [x] **查詢的主字右邊的注音和下面的拼音** - 實現注音符號和拼音顯示功能
- [x] **多語言音檔路由** - 華語、台語、客語使用不同 CDN 端點
- [x] **游標滑過文字顯示簡介框** - 實現 Tooltip 功能，包含注音、拼音、基本定義顯示

## 🔄 進行中項目

目前沒有進行中的項目

## 📋 待完成項目

### 1. 打星號與字詞記錄簿

- [x] **星號按鈕實現**
  - [x] 在每個字典頁面添加星號圖示按鈕
  - [x] 實現星號狀態切換（空星號 ↔ 實心星號）
  - [x] 添加 hover 提示文字（「加入字詞記錄簿」/「已加入記錄簿」）
  - [x] 應用正確的 CSS 類名 (`.star`, `.icon-star`, `.icon-star-empty`)
  - [x] 參考原專案檔案: `moedict-webkit/view.ls` 第100-106行, `Star` 組件

- [x] **LocalStorage 儲存機制**
  - [x] 實現字詞收藏的 LocalStorage 儲存
  - [x] 使用 `STARRED[LANG]` 物件儲存各語言的收藏字詞
  - [x] 字詞格式：`"字詞名稱"\n` (包含引號和換行)
  - [x] 實現 `setPref("starred-#LANG", STARRED[LANG])` 儲存機制
  - [x] 參考原專案檔案: `moedict-webkit/main.ls` 第43行, 第605-619行

- [x] **星號點擊事件處理**
  - [x] 實現星號點擊切換收藏狀態
  - [x] 點擊空星號：加入收藏，切換為實心星號
  - [x] 點擊實心星號：移除收藏，切換為空星號
  - [x] 更新導航列中的收藏按鈕背景色提示
  - [x] 參考原專案檔案: `moedict-webkit/main.ls` 第605-619行

- [ ] **字詞記錄簿頁面**
  - [ ] 實現 `=*` 路由處理，顯示收藏的字詞列表
  - [ ] 從 LocalStorage 讀取 `STARRED[LANG]` 資料
  - [ ] 解析字詞列表並生成連結列表
  - [ ] 實現收藏字詞的點擊導航功能
  - [ ] 參考原專案檔案: `moedict-webkit/main.ls` 第547行, `load-json` 函數

- [ ] **多語言支援**
  - [ ] 為不同語言（華語、台語、客語、兩岸）分別儲存收藏
  - [ ] 使用 `starred-a`, `starred-t`, `starred-h`, `starred-c` 作為 LocalStorage 鍵名
  - [ ] 確保各語言收藏獨立管理
  - [ ] 參考原專案檔案: `moedict-webkit/main.ls` 第43行, `HASH-OF` 對應關係


### 2. 多語言超連結功能

- [ ] **跨語言對照超連結**
  - [ ] 實現台語文字超連結（`'` 開頭路由）
  - [ ] 實現客語文字超連結（`:` 開頭路由）
  - [ ] 實現兩岸詞典文字超連結（`~` 開頭路由）
  - [ ] 確保超連結正確導向對應語言頁面
  - [ ] 參考原專案檔案: `view.ls` 第85-98行, `XRefs` 組件

- [ ] **多語言路由支援**
  - [ ] 實現台語路由處理（`/t/` 或 `'` 前綴）
  - [ ] 實現客語路由處理（`/h/` 或 `:` 前綴）
  - [ ] 實現兩岸詞典路由處理（`/c/` 或 `~` 前綴）
  - [ ] 確保路由正確載入對應語言字典資料
  - [ ] 參考原專案檔案: `view.ls` 第85行, `HASH-OF` 常數


### 3. 部首及筆畫區

- [x] **部首顯示**
  - [x] 實現部首字形顯示
  - [x] 顯示部首名稱
  - [x] 應用正確的 CSS 類名 (`.radical`)
  - [x] 參考原專案檔案: `view.ls` 第49-57行

- [x] **筆畫數顯示**
  - [x] 顯示總筆畫數
  - [x] 顯示非部首筆畫數
  - [x] 顯示計算公式 (部首筆畫 + 非部首筆畫 = 總筆畫)
  - [x] 應用正確的 CSS 類名 (`.count`)
  - [x] 參考原專案檔案: `view.ls` 第52-56行

- [x] **部首檢索連結**
  - [x] 實現部首檢索功能
  - [x] 連結到部首表頁面 (`#@`)
  - [x] 應用正確的 CSS 類名 (`.xref`)
  - [x] 參考原專案檔案: `view.ls` 第525-533行, `RadicalGlyph` 組件

- [ ] **創建部首表頁面**
  - [ ] **部首表路由處理**
    - [ ] 實現 `/@` 路由（華語部首表）
    - [ ] 實現 `/@{部首}` 路由（特定部首的字列表，如 `/@人`）
    - [ ] 實現 `/~@` 路由（兩岸詞典部首表）
    - [ ] 實現 `/~@{部首}` 路由（兩岸詞典特定部首）
    - [ ] 參考原專案檔案: `main.ls` 第666行, `server.ls` 第307行

  - [ ] **部首表資料載入**
    - [ ] 從 R2 讀取 `@.json` 檔案（部首總表）
    - [ ] 資料結構：二維陣列 `[[筆畫0部首], [筆畫1部首], [筆畫2部首], ...]`
    - [ ] 從 R2 讀取 `@{部首}.json` 檔案（特定部首下的字列表）
    - [ ] 資料結構：二維陣列 `[[餘0筆], [餘1筆], [餘2筆], ...]`，每個元素為該餘筆的字陣列
    - [ ] 參考原專案檔案: `a/@.json`, `a/@人.json`

  - [ ] **部首表頁面組件 (RadicalTablePage)**
    - [ ] 實現 `RadicalTablePage` Preact 組件
    - [ ] 顯示標題「部首表」或「{部首} 部」
    - [ ] 按筆畫數分組顯示部首
    - [ ] 每個筆畫數顯示為一行：`{筆畫數} {部首1} {部首2} ...`
    - [ ] 部首可點擊，連結到 `/@{部首}` 頁面
    - [ ] 參考原專案檔案: `view.ls` 第534-557行, `RadicalTable` 組件

  - [ ] **特定部首字列表組件**
    - [ ] 顯示標題「{部首} 部」，附帶返回部首表的連結
    - [ ] 按餘筆數分組顯示字
    - [ ] 每組顯示為：`+{餘筆數} {字1} {字2} {字3} ...`
    - [ ] 字可點擊，連結到該字的詞條頁面
    - [ ] 使用 `<hr>` 分隔不同餘筆數的組
    - [ ] 參考原專案檔案: `view.ls` 第549-556行

  - [ ] **部首表樣式**
    - [ ] 應用 `.stroke-count` 類名（筆畫數標籤）
    - [ ] 應用 `.stroke-list` 類名（字或部首列表）
    - [ ] 應用 `.stroke-char` 類名（可點擊的字或部首）
    - [ ] 應用 `.list` 類名（整體列表容器）
    - [ ] 實現適當的間距和排版
    - [ ] 參考原專案檔案: `view.ls` 第554-556行, 原專案 CSS

  - [ ] **導航列整合**
    - [ ] 在導航列下拉選單中加入「…部首表」選項
    - [ ] 華語：連結到 `/#@`
    - [ ] 兩岸：連結到 `/#~@`
    - [ ] 參考原專案檔案: `scripts/Nav.jsx` 第84、92行


### 4. 筆順鈕與筆順動畫

- [ ] **筆順按鈕實現**
  - [ ] 在每個字典頁面添加鉛筆圖示按鈕
  - [ ] 應用正確的 CSS 類名 (`.stroke`, `.icon-pencil`, `.iconic-circle`)
  - [ ] 添加 hover 提示文字（「筆順動畫」）
  - [ ] 實現按鈕點擊事件處理
  - [ ] 參考原專案檔案: `moedict-webkit/view.ls` 第48行, `a-stroke` 按鈕

- [ ] **筆順動畫容器**
  - [ ] 實現 `#strokes` 容器顯示區域
  - [ ] 支援動畫的顯示/隱藏切換
  - [ ] 實現點擊筆順按鈕時的容器切換邏輯
  - [ ] 添加淡入淡出動畫效果
  - [ ] 參考原專案檔案: `moedict-webkit/main.ls` 第621-625行

- [ ] **筆順動畫引擎**
  - [ ] 實現 Canvas 和 SVG 兩種動畫引擎支援
  - [ ] Canvas 引擎：使用 `jquery.strokeWords.js` 和相關依賴
  - [ ] SVG 引擎：使用 `raphael.js` 作為降級方案
  - [ ] 動態載入必要的 JavaScript 庫
  - [ ] 參考原專案檔案: `moedict-webkit/main.ls` 第952-972行, `strokeWords` 函數

- [ ] **筆順資料載入**
  - [ ] 實現筆順資料的 API 調用
  - [ ] 支援多種資料格式：JSON、XML、Binary
  - [ ] 處理 UTF-8 編碼的字元轉換
  - [ ] 實現資料載入失敗的錯誤處理
  - [ ] 參考原專案檔案: `moedict-webkit/main.ls` 第922-950行, `fetchStrokeXml` 和 `strokeWord` 函數

- [ ] **歷代書體功能**
  - [ ] 實現「歷代書體」按鈕顯示
  - [ ] 支援六種書體：楷書、篆書、隸書、行書、草書、金文
  - [ ] 從 API 載入各書體的 GIF 動畫資料
  - [ ] 實現書體圖片的動態載入和顯示
  - [ ] 添加書體切換和選擇功能
  - [ ] 參考原專案檔案: `moedict-webkit/view.ls` 第172-197行, 歷代書體按鈕

- [ ] **動畫播放控制**
  - [ ] 實現筆順動畫的播放控制
  - [ ] 支援動畫的開始、暫停、重播功能
  - [ ] 實現動畫速度調整
  - [ ] 添加動畫進度指示器
  - [ ] 參考原專案檔案: `moedict-webkit/js/jquery.strokeWords.js` 第729-772行

- [ ] **視覺效果優化**
  - [ ] 實現網格線顯示（九宮格）
  - [ ] 添加筆畫顏色和粗細設定
  - [ ] 實現筆畫的漸進式繪製動畫
  - [ ] 優化動畫的流暢度和視覺效果
  - [ ] 參考原專案檔案: `moedict-webkit/main.ls` 第933-950行, 網格線和繪製邏輯


**原專案實作重點記錄：**

1. **核心技術棧**：
   - 使用 jQuery UI Tooltip 插件 (`moedict-webkit/js/bootstrap/tooltip.js`)
   - 使用 hoverIntent 插件 (`moedict-webkit/js/jquery.hoverIntent.js`) 避免過度觸發
   - 使用 jQuery 選擇器 `$('#result a[href]:not(.xref)')` 選取所有內部連結

2. **觸發機制**：
   - `hoverIntent` 設定 `timeout: 250ms` 延遲觸發
   - `tooltip` 設定 `show: 100ms, hide: 100ms` 顯示/隱藏動畫
   - 使用 `callLater` 函數實現非同步載入

3. **內容載入**：
   - 從 `href` 屬性提取字詞 ID
   - 先檢查 `htmlCache[LANG][id]` 快取
   - 如果沒有快取，調用 `load-json` 函數載入 JSON 資料
   - 使用 `fill-json` 函數將 JSON 轉換為 HTML

4. **樣式處理**：
   - 使用 `tooltipClass: "prefer-pinyin-#{true}"` 動態切換樣式
   - CSS 類名 `.ui-tooltip` 控制簡介框外觀
   - 支援注音/拼音切換顯示

5. **效能優化**：
   - 使用 `htmlCache` 快取已載入的內容
   - `hoverIntent` 防止快速滑動時過度觸發
   - 延遲載入避免阻塞 UI

### 5. 詞性標記 (名詞、動詞、形容詞、副詞)

- [ ] **詞性標記顯示**
  - [ ] 實現紅底白字的詞性標記
  - [ ] 支援的詞性類型：
    - [ ] 名詞 (`名`)
    - [ ] 動詞 (`動`)
    - [ ] 形容詞 (`形`)
    - [ ] 副詞 (`副`)
    - [ ] 介詞 (`介`)
    - [ ] 代詞 (`代`)
    - [ ] 助詞 (`助`)
    - [ ] 嘆詞 (`歎`)
  - [ ] 應用正確的 CSS 類名 (`.part-of-speech`)
  - [ ] 參考原專案檔案: `view.ls` 第473-479行, `DefinitionList` 組件

- [ ] **詞性標記樣式**
  - [ ] 實現紅底白字的視覺效果
  - [ ] 確保標記的可讀性和美觀性
  - [ ] 處理多個詞性的並列顯示
  - [ ] 參考原專案檔案: `sass/_theme.scss` 相關樣式

- [ ] **詞性資料處理**
  - [ ] 從字典資料中提取詞性資訊
  - [ ] 處理詞性標記的解析邏輯
  - [ ] 實現詞性標記的動態生成
  - [ ] 參考原專案檔案: `view.ls` 第473-479行

### 6. 其他內容頁功能

- [ ] **例句和引文**
  - [ ] 實現例句顯示 (`.example`)
  - [ ] 實現引文顯示 (`.quote`)
  - [ ] 處理例句的格式化和樣式
  - [ ] 參考原專案檔案: `view.ls` 第490-522行, `Definition` 組件

- [ ] **同義詞和反義詞**
  - [ ] 實現同義詞顯示 (`.synonyms`)
  - [ ] 實現反義詞顯示 (`.antonyms`)
  - [ ] 實現異體字顯示 (`.variants`)
  - [ ] 應用正確的標籤 (似、反、異)
  - [ ] 參考原專案檔案: `view.ls` 第481-488行, `decorate-nyms` 函數

- [ ] **定義格式化**
  - [ ] 實現定義的 HTML 格式化
  - [ ] 處理內部連結 (`<a>` 標籤)
  - [ ] 實現定義編號和標記
  - [ ] 參考原專案檔案: `view.ls` 第654-665行, `expand-def` 函數

- [ ] **特殊標記處理**
  - [ ] 實現區域標記 (`.regional`)
  - [ ] 實現特定標記 (`.specific`)
  - [ ] 實現變體標記 (`.variant`)
  - [ ] 參考原專案檔案: `view.ls` 第612-639行, `h` 函數

## 📁 相關檔案清單

### 原專案參考檔案
- `moedict-webkit/view.ls` - 主要 React 組件和邏輯
- `moedict-webkit/index.html` - HTML 結構參考
- `moedict-webkit/sass/_theme.scss` - 樣式定義
- `moedict-webkit/js/jquery.strokeWords.js` - 筆順動畫庫
- `moedict-webkit/bin/` - 筆順資料檔案

### 新專案需要創建的檔案
- `cf-moedict-webkit/src/dictionary-content.tsx` - 字典內容組件
- `cf-moedict-webkit/src/phonetics-component.tsx` - 注音拼音組件
- `cf-moedict-webkit/src/audio-component.tsx` - 朗讀功能組件
- `cf-moedict-webkit/src/radical-component.tsx` - 部首筆畫組件
- `cf-moedict-webkit/src/stroke-animation.tsx` - 筆順動畫組件
- `cf-moedict-webkit/src/part-of-speech.tsx` - 詞性標記組件

### 需要研究的技術
- [ ] **筆順資料格式** - 研究原專案的筆順資料存儲格式
- [ ] **音檔載入機制** - 研究音檔的載入和播放機制
- [ ] **Ruby 標註技術** - 研究 HTML5 Ruby 標註的實現
- [ ] **語音合成 API** - 研究瀏覽器語音合成 API 的使用

---

**計畫版本**: v1.6
**創建日期**: 2025-10-13
**最後更新**: 2025-10-23
